# Предсказания ЖКХ работ
## Запуск

Процесс предсказаний показан в файлике `predict.ipynb`

#### Шаг 0. Импортируем библиотеки:

```
import pandas as pd
from predict_model import predict
```

#### Шаг 1. Читаем dataset (и возможно отделяем от него часть)

Файл с данными -- обязательно в `csv`-формате. Важно, чтобы файл был такой структура, какая она в примере (названия колонок тоже важны), не критично, если будут дополнительные колонки. 

```
d1 = pd.read_csv('data/1_houses.csv')
d1 = d1[:10] # будем давать предсказания для первых 10 строк
```


#### Шаг 2. Делаем предсказания

Функция возвращает 2 pandas-объекта с короткими сведениями об объекте и предсказанными датами и длительностями обслуживания: для единичных случаев (инцидентов), и для кап. ремонтов.

```
incidents, capitals = predict(d1)
```

Примеры выводимых таблиц -- в `predict.ipynb`.

## Файлы

* `requirements.txt` - библиотеки, нужные для корректного запуска моделек
* jupyter-ноутбуки подготовки и тренировки моделей:
    * `dataset_preparation.ipynb` - preparation 
    * `train_models.ipynb` - процесс тренировки регрессионных моделей с использованием Импутации, Скейлинга и регрессора CatBoost
    * `predict.ipynb` - процесс использования натренированных моделей.
* Файлы-утилиты (с доп. функциями и элементами):
    * `utils.py` - функции и объекты-утилиты для начального этапа работ
    * `predict_utils.py` - функции и объекты-утилиты для тренировки и предсказаний.
* `predict_model.py` - файл с функцией для предсказаний (пример использования в `predict.ipynb`) 

## Как оно работает

Суть работы алгоритма — регрессия по количествам дням до событий/кап.ремонтов 

Как предиктивные признаки берутся непрерывные и категориальные признаки по каждому из объектов (всего — 18 признаков):
* категориальные — 8 (среди них: материал стен, потолка) -- подробнее в `train_models.ipynb`
* непрерывные — 10 (среди них: год постройки, площади, количество лифтов).

Так как всего видов событий много, то события сгруппированы по тематикам, и ведется предсказания по ним (например, все, что связанное с лифтами -- класс "Лифт", с канализацией -- "Канализация"):
* для кап.ремонтов они даны (всего 29 классов);
* для событий они картирование вручную (всего выделено 31 класс).

Для каждого из этого класса в ходе работы алгоритма проводится предсказание ближайшей даты (с помощью регрессии) и продолжительности проведения (средняя продолжительность проведения событий данного класса).

В ходе регрессии признаки каждого из классов проходят следующую обработку:

* импутация (KNNimputer, k=5), для непрерывных признаков берется среднее по кластеру, для категориальных — мода.
* нормализация (StandardScaler), только для непрерывных признаков 
* регрессия: CatBoostRegression. 

Данный алгоритм (CatBoostRegressor) выбран как в связи с его большей точностью на данной задаче (по сравнению с другими регрессорами), так и потому что алгоритмы ML (в данном случае, решающие деревья), в отличие от DL (нейронные сети) более интерпретируемы: можно вытащить веса и понять, какие признаки влияют сильнее на данное предсказание. 

#### Планируемые улучшения
В будущем планируется:

* реализовать функциональность подсвечивание значимых признаков (вытащив веса регрессора);
* сделать анализ корреляций между событиями и кап.ремонтами.

